{"version":3,"sources":["../src/scroll-to.service.ts"],"names":[],"mappings":"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","file":"scroll-to.service.js","sourceRoot":"","sourcesContent":["import { Injectable, ElementRef, PLATFORM_ID, Inject } from '@angular/core';\r\nimport { DOCUMENT } from '@angular/platform-browser';\r\nimport { isPlatformBrowser } from '@angular/common';\r\n\r\nimport { Observable } from 'rxjs/Observable';\r\nimport { ReplaySubject } from 'rxjs/ReplaySubject';\r\n\r\nimport { TimeOut } from './decorators/scroll-to-timeout.decorator';\r\nimport { ScrollToAnimationEasing } from './models/scroll-to-easing.model';\r\nimport { ScrollToConfig } from './models/scroll-to-config.model';\r\nimport { ScrollToTarget } from './models/scroll-to-targets.model';\r\nimport { ScrollToListenerTarget } from './models/scroll-to-targets.model';\r\nimport { ScrollToAnimation } from './statics/scroll-to-animation';\r\nimport {\r\n\tstripHash,\r\n\tisString,\r\n\tisNumber,\r\n\tisElementRef,\r\n\tisWindow,\r\n\tmergeConfigWithDefaults\r\n} from './statics/scroll-to-helpers';\r\n\r\n\r\nexport class ScrollToService {\r\n\r\n\tprivate _animation: ScrollToAnimation;\r\n\r\n\tconstructor(\r\n\t\t private _document: any,\r\n\t\t private _platform_id: any\r\n\t) {\r\n\t}\r\n\r\n\t/**\r\n\t * Target an Element to scroll to.\r\n\t *\r\n\t * @todo type 'any' in Observable should become custom type like 'ScrollToEvent' (base class), see issue comment:\r\n\t * \t- https://github.com/nicky-lenaers/ngx-scroll-to/issues/10#issuecomment-317198481\r\n\t *\r\n\t * @param event \t\t\t\tNative Browser Event\r\n\t * @param config \t\t\t\tConfiguration Object\r\n\t * @returns \t\t\t\t\tObservable\r\n\t */\r\n\t@TimeOut()\r\n\tpublic scrollTo(event: Event, config: ScrollToConfig): Observable<any> {\r\n\r\n\t\tif (!isPlatformBrowser(this._platform_id)) return new ReplaySubject().asObservable();\r\n\r\n\t\treturn this._start(event, config);\r\n\t}\r\n\r\n\t/**\r\n\t * Start a new Animation.\r\n\t *\r\n\t * @todo Emit proper events from subscription\r\n\t *\r\n\t * @param event \t\t\t\tNative Browser Event\r\n\t * @param config \t\t\t\tConfiguration Object\r\n\t * @returns \t\t\t\t\tObservable\r\n\t */\r\n\tprivate _start(event: Event, config: ScrollToConfig): Observable<number> {\r\n\r\n\t\t// Merge config with default values\r\n\t\tconst merged_config = mergeConfigWithDefaults(config);\r\n\r\n\t\tif (this._animation) this._animation.stop();\r\n\r\n\t\tconst container = this._getFirstScrollableParent(event.target as HTMLElement);\r\n\t\tconst target_node = this._getTargetNode(merged_config.target);\r\n\t\tconst listenerTarget = this._getListenerTarget(container);\r\n\t\tconst is_window = isWindow(listenerTarget);\r\n\t\tconst to: number = is_window ? target_node.offsetTop : target_node.getBoundingClientRect().top;\r\n\r\n\t\t// Create Animation\r\n\t\tthis._animation = new ScrollToAnimation(container, listenerTarget, is_window, to, merged_config, isPlatformBrowser(this._platform_id));\r\n\r\n\t\tconst stop_events: string[] = ['mousewheel', 'DOMMouseScroll', 'touchstart'];\r\n\t\tconst stop_event_handler = () => this._animation.stop();\r\n\r\n\t\t// Add Stop Event Listeners\r\n\t\tthis._addStopEventListeners(stop_events, listenerTarget, stop_event_handler);\r\n\r\n\t\t// Start Animation\r\n\t\tconst animation$ = this._animation.start();\r\n\r\n\t\tconst subscription = animation$\r\n\t\t\t.subscribe(\r\n\t\t\t\t() => {},\r\n\t\t\t\t() => {},\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis._removeStopEventListeners(stop_events, listenerTarget, stop_event_handler);\r\n\t\t\t\t\tsubscription.unsubscribe();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\treturn animation$;\r\n\t}\r\n\r\n\t/**\r\n\t * Add listeners for the Animation Stop Event.\r\n\t *\r\n\t * @param events \t\t\t\t\tList of events to listen to\r\n\t * @param listenerTarget \t\t\tTarget to attach the listener on\r\n\t * @param handler \t\t\t\t\tHandler for when the listener fires\r\n\t * @returns void\r\n\t */\r\n\tprivate _addStopEventListeners(events: string[], listenerTarget: ScrollToListenerTarget, handler: EventListenerOrEventListenerObject): void {\r\n\t\tevents.forEach(event => listenerTarget.addEventListener(event, handler));\r\n\t}\r\n\r\n\t/**\r\n\t * Remove listeners for the Animation Stop Event.\r\n\t *\r\n\t * @param events \t\t\t\t\tList of events to listen to\r\n\t * @param listenerTarget \t\t\tTarget to attach the listener on\r\n\t * @param handler \t\t\t\t\tHandler for when the listener fires\r\n\t * @returns void\r\n\t */\r\n\tprivate _removeStopEventListeners(events: string[], listenerTarget: ScrollToListenerTarget, handler: EventListenerOrEventListenerObject): void {\r\n\t\tevents.forEach(event => listenerTarget.removeEventListener(event, handler));\r\n\t}\r\n\r\n\t/**\r\n\t * Find the first scrollable parent node of an element.\r\n\t *\r\n\t * @param nativeElement \t\t\tThe element to search from\r\n\t * @return \t\t\t\t\t\t\tThe first scrollable parent element\r\n\t */\r\n\tprivate _getFirstScrollableParent(nativeElement: HTMLElement): HTMLElement {\r\n\r\n\t\tlet style: CSSStyleDeclaration = window.getComputedStyle(nativeElement);\r\n\r\n\t\tconst overflow_regex: RegExp = /(auto|scroll)/;\r\n\r\n\t\tif (style.position === 'fixed') throw new Error(`Scroll item cannot be positioned 'fixed'`);\r\n\r\n\t\t// Recursive Loop Parents\r\n\t\tfor (let parent = nativeElement; parent = parent.parentElement; null) {\r\n\r\n\t\t\t// Recalculate Style\r\n\t\t\tstyle = window.getComputedStyle(parent);\r\n\r\n\t\t\t// Skip Absolute Positioning\r\n\t\t\tif (style.position === 'absolute') continue;\r\n\r\n\t\t\t// Skip Hidden Overflow\r\n\t\t\tif (style.overflow === 'hidden' || style.overflowY === 'hidden') continue;\r\n\r\n\t\t\t// Test Overflow\r\n\t\t\tif (overflow_regex.test(style.overflow + style.overflowY + style.overflowX)) return parent;\r\n\r\n\t\t\t// Return Body\r\n\t\t\tif (parent.tagName === 'BODY') return parent;\r\n\t\t}\r\n\r\n\t\tthrow new Error(`No scrollable parent found for element ${nativeElement.nodeName}`);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the Target Node to scroll to.\r\n\t *\r\n\t * @param id \t\t\tThe given ID of the node, either a string or an element reference\r\n\t * @returns \t\t\tTarget Node\r\n\t */\r\n\tprivate _getTargetNode(id: ScrollToTarget): HTMLElement {\r\n\r\n\t\tlet target_node: HTMLElement;\r\n\r\n\t\tif (isString(id)) {\r\n\r\n\t\t\ttarget_node = this._document.getElementById(stripHash(id));\r\n\r\n\t\t} else if (isNumber(id)) {\r\n\r\n\t\t\ttarget_node = this._document.getElementById(String(id));\r\n\r\n\t\t} else if(isElementRef(id)) {\r\n\r\n\t\t\ttarget_node = id.nativeElement;\r\n\r\n\t\t}\r\n\r\n\t\tif (!target_node) throw new Error('Unable to find Target Element');\r\n\r\n\t\treturn target_node;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve the Listener target.\r\n\t *\r\n\t * @param container \t\t\t\tThe HTML Container element\r\n\t * @returns \t\t\t\t\t\tListener\r\n\t */\r\n\tprivate _getListenerTarget(container: HTMLElement): ScrollToListenerTarget {\r\n\t\treturn container.tagName.toUpperCase() === 'BODY' ? window : container;\r\n\t}\r\n\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: undefined, decorators: [{ type: Inject, args: [DOCUMENT, ] }, ]},\n{type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID, ] }, ]},\n];\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}